<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>SNIPER V14.1.0 | ALL-MARKET SCAN</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
    body { background-color: #000; color: #FFD700; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
    .vp-break-card { border: 2px solid #a855f7; box-shadow: 0 0 20px #a855f7; background: #2a0045 !important; animation: blink 1s infinite; }
    @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    .gold-border { border: 1px solid #1a1a1a; background: #0a0a0a; }
    input[type=range] { accent-color: #FFD700; height: 4px; cursor: pointer; }
</style>
</head>
<body class="h-screen flex flex-col">

<header class="p-4 border-b border-yellow-900 bg-black flex justify-between items-center shrink-0">
    <div class="flex items-center gap-4">
        <h1 class="text-xl font-black text-yellow-500 italic uppercase">‚ö° SNIPER V14.1.0</h1>
        <span class="text-[9px] bg-red-900 px-2 py-0.5 rounded text-white font-bold">ALL-SCAN MODE</span>
    </div>
    
    <div class="flex gap-4 bg-zinc-900 p-2 rounded border border-zinc-800 text-[9px] font-bold">
        <div class="flex flex-col"><span>üìâ GAP (ÁúüÁ©∫) <span id="v_gap">1.5%</span></span><input type="range" id="p_gap" min="5" max="50" value="15" oninput="sync()"></div>
        <div class="flex flex-col"><span>‚ö° MOM (ÊåÅÂÄâ) <span id="v_mom">0.8%</span></span><input type="range" id="p_mom" min="1" max="50" value="8" oninput="sync()"></div>
        <div class="flex flex-col"><span>üåÄ DEP (2KÊ∑±Â∫¶) <span id="v_dep">2.0k</span></span><input type="range" id="p_dep" min="5" max="100" value="20" oninput="sync()"></div>
        <div class="flex flex-col"><span>üöÄ DRV (ÈáèËÉΩ) <span id="v_drv">90</span></span><input type="range" id="p_drv" min="10" max="150" value="90" oninput="sync()"></div>
    </div>

    <button onclick="toggleSystem()" id="mainBtn" class="bg-blue-600 px-10 py-1 rounded text-white font-black text-xs">START SCAN ALL</button>
</header>

<main class="flex-1 p-4 overflow-y-auto bg-zinc-950">
    <div id="dashboard" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3"></div>
</main>

<script>
let isRunning = false, timer = null, stats = {};
let PARAMS = { GAP: 0.015, MOM: 0.008, DEP: 2000, DRV: 90 };

function sync() {
    const g = document.getElementById('p_gap').value, m = document.getElementById('p_mom').value, d = document.getElementById('p_dep').value, v = document.getElementById('p_drv').value;
    PARAMS.GAP = g/1000; PARAMS.MOM = m/1000; PARAMS.DEP = d * 100; PARAMS.DRV = v;
    document.getElementById('v_gap').innerText = (g/10).toFixed(1)+'%';
    document.getElementById('v_mom').innerText = (m/10).toFixed(1)+'%';
    document.getElementById('v_dep').innerText = (d/10).toFixed(1)+'k';
    document.getElementById('v_drv').innerText = v;
}

// [B] Ê†∏ÂøÉÁÆóÊ≥ïÔºöPOC ÁúüÁ©∫ÂçÄËàá 2K Ê∑±Â∫¶
async function checkStrategy(symbol, curPrice, tickerData) {
    try {
        // [B1] Ê®°Êì¨ POC ËàáÁúüÁ©∫ÂçÄ (Âà©Áî® 24h Êï∏ÊìöÈÄ≤Ë°åÁ¨¨‰∏ÄÂ±§ÂÖ®Â†¥ÈÅéÊøæÔºåÈÅøÂÖç API ÁÇ∏Êéâ)
        const high = parseFloat(tickerData.highPrice);
        const low = parseFloat(tickerData.lowPrice);
        const avg = parseFloat(tickerData.weightedAvgPrice);
        const poc = (high + low + avg) / 3;
        const gap = (curPrice - poc) / poc;

        // [B2] Â¶ÇÊûúÁ¨¶ÂêàÁúüÁ©∫Á™ÅÁ†¥ÔºåÁ´ãÂç≥ÁôºÈÄÅ API ÊäìÂèñ„ÄåÁ≤æÁ¢∫Ë®ÇÂñÆÁ∞ø„ÄçÈÄ≤Ë°å 2K ÈÅéÊøæ
        if (gap > PARAMS.GAP) {
            const dRes = await fetch(`https://fapi.binance.com/fapi/v1/depth?symbol=${symbol}&limit=20`);
            const depth = await dRes.json();
            const asks = depth.asks.slice(0, 10).reduce((s, [p, q]) => s + (p * q), 0);
            
            return { isBreak: (asks > PARAMS.DEP), gap, poc, asks };
        }
        return { isBreak: false, gap, poc, asks: 0 };
    } catch (e) { return null; }
}

// [C] ÂÖ®Â†¥ÊéÉÊèèÊ†∏ÂøÉÔºö‰∏âÁßí‰∏ÄÊéÉÔºå‰∏çÊîæÈÅé‰ªª‰ΩïÂπ£
async function updateData() {
    try {
        const pRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
        const allTickers = await pRes.json();
        
        // ÈÅéÊøæÂá∫ÊâÄÊúâ USDT ‰∫§ÊòìÂ∞ç (ÈÄöÂ∏∏Êúâ 200+ ÂÄã)
        const symbols = allTickers.filter(x => x.symbol.endsWith('USDT'));
        
        // ‰∏¶Ë°åËôïÁêÜÂÖ®Â†¥Á≠ñÁï•ÂàÜÊûê
        const promises = symbols.map(async (t) => {
            const price = parseFloat(t.lastPrice);
            const res = await checkStrategy(t.symbol, price, t);
            if (res) {
                stats[t.symbol] = { ...res, price };
            }
        });

        await Promise.all(promises);
        render();
    } catch (e) { console.error("ÊéÉÊèèÁï∞Â∏∏"); }
}

function render() {
    const container = document.getElementById('dashboard');
    // Âè™È°ØÁ§∫Á¨¶ÂêàÁ≠ñÁï•ÊàñÊúâÊΩõÂäõÁöÑÂπ£ (Gap > 0)ÔºåÈÅøÂÖçÁï´Èù¢Â°ûÊªø 200 ÂÄãÊ≤íÂãïÈùúÁöÑÂç°Áâá
    const activeList = Object.entries(stats)
        .filter(([s, st]) => st.gap > 0)
        .sort((a, b) => b[1].gap - a[1].gap);

    container.innerHTML = activeList.map(([s, st]) => `
        <div class="p-3 rounded ${st.isBreak ? 'vp-break-card' : 'gold-border'} transition-all">
            <div class="flex justify-between items-center mb-1">
                <h2 class="font-black text-white italic text-[12px]">${s.replace('USDT','')}</h2>
                ${st.isBreak ? '<span class="text-[8px] text-white font-bold bg-purple-600 px-1 rounded">2K_HIT</span>' : ''}
            </div>
            <div class="text-[9px] space-y-0.5 font-bold">
                <div class="flex justify-between"><span>GAP:</span><span class="${st.gap > PARAMS.GAP ? 'text-green-400' : 'text-zinc-500'}">${(st.gap*100).toFixed(2)}%</span></div>
                <div class="flex justify-between"><span>DEPTH:</span><span class="text-blue-400">$${(st.asks/1000).toFixed(1)}k</span></div>
                <div class="mt-1 pt-1 border-t border-zinc-800 text-[8px] flex justify-between text-zinc-600 uppercase">
                    <span>$${st.price < 1 ? st.price.toFixed(5) : st.price.toFixed(2)}</span>
                    <span>POC: ${(st.poc).toFixed(2)}</span>
                </div>
            </div>
        </div>
    `).join('');
}

function toggleSystem() {
    isRunning = !isRunning;
    const btn = document.getElementById('mainBtn');
    btn.innerText = isRunning ? "STOP SCAN" : "START SCAN ALL";
    btn.className = isRunning ? "bg-red-900 px-10 py-1 rounded text-white font-black text-xs" : "bg-blue-600 px-10 py-1 rounded text-white font-black text-xs";
    if (isRunning) { updateData(); loop(); } else { clearTimeout(timer); }
}

async function loop() {
    if (isRunning) {
        await updateData();
        timer = setTimeout(loop, 3000); // Âö¥Ê†º 3 ÁßíÂÖ®ÊéÉ‰∏ÄÊ¨°
    }
}
</script>
</body>
</html>
