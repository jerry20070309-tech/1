<!DOCTYPE html>
<html>
<head>
    <title>‚ö° SNIPER V8.2.2 - MA & POC RESTORED</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #050505; color: #0f0; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        .card { background: #0a0a0a; border: 1px solid #1a1a1a; transition: 0.2s; cursor: pointer; position: relative; }
        .card:hover { border-color: #3b82f6; background: #0d0d0d; }
        .poc-break { border-left: 4px solid #22c55e !important; }
        .ma-squeeze { border-right: 4px solid #eab308 !important; }
        .tag { font-size: 8px; padding: 1px 3px; font-weight: 900; border-radius: 2px; text-transform: uppercase; }
        .pinned { border: 2px solid #3b82f6 !important; background: #081221 !important; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #222; }
    </style>
</head>
<body class="flex h-screen text-[10px]">
    <div class="flex-1 flex flex-col p-3 overflow-hidden">
        <div class="bg-zinc-900/50 p-4 rounded-xl mb-3 border border-white/5">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-black text-blue-500 italic uppercase">‚ö° Sniper V8.2.2 <span class="text-zinc-600 text-[10px] not-italic">Engine Fixed</span></h1>
                <div class="flex gap-4">
                    <div id="reqStatus" class="flex gap-2 items-center text-[9px]">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-zinc-400">NET SAFE: 2 PACKETS/3S</span>
                    </div>
                    <button id="sysBtn" onclick="toggleSystem()" class="bg-blue-600 text-white px-4 py-1 rounded font-black uppercase hover:bg-blue-500 transition">Start Radar</button>
                </div>
            </div>
            <div class="grid grid-cols-4 gap-4 uppercase font-bold text-zinc-400">
                <div class="space-y-1">
                    <div class="flex justify-between text-yellow-500"><span>üåÄ MA SQZ (Êì†Â£ìÂ∫¶)</span><span id="v_sqz">1.2%</span></div>
                    <input type="range" id="i_sqz" min="1" max="50" value="12" class="w-full h-1 bg-zinc-800 appearance-none rounded cursor-pointer">
                </div>
                <div class="space-y-1">
                    <div class="flex justify-between text-green-500"><span>üéØ POC GAP (Á™ÅÁ†¥)</span><span id="v_poc">0.5%</span></div>
                    <input type="range" id="i_poc" min="0" max="20" value="5" class="w-full h-1 bg-zinc-800 appearance-none rounded cursor-pointer">
                </div>
                <div class="space-y-1">
                    <div class="flex justify-between text-red-500"><span>üìâ DRV SENSE (ÁúüÁ©∫)</span><span id="v_drv">90</span></div>
                    <input type="range" id="i_drv" min="10" max="150" value="90" class="w-full h-1 bg-zinc-800 appearance-none rounded cursor-pointer">
                </div>
                <div class="space-y-1 text-[8px] flex flex-col justify-center">
                    <p>TSL: -2.0% (ÁßªÂãïÊ≠¢Êêç)</p>
                    <p>TTP: +5.0% (ÁßªÂãïÊ≠¢Áõà)</p>
                </div>
            </div>
        </div>
        <div id="list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 overflow-y-auto pr-1"></div>
    </div>

<script>
    let stats = {}, pinned = new Set(), isRunning = false;
    const EXCLUDE = ['BTCUSDT','ETHUSDT','SOLUSDT','XRPUSDT'];
    let FILTER = { SQZ: 0.012, POC: 0.005, DRV: 90 };

    async function scan() {
        if(!isRunning) return;
        const startTime = Date.now();

        try {
            // Âö¥Ê†ºÂÉÖÁôºÈÄÅ 2 ÂÄãÂ§ßÂ∞ÅÂåÖ
            const [tRes, bRes] = await Promise.all([
                fetch('https://fapi.binance.com/fapi/v1/ticker/24hr'),
                fetch('https://fapi.binance.com/fapi/v1/ticker/bookTicker')
            ]);
            const [tickers, books] = await Promise.all([tRes.json(), bRes.json()]);
            const bookMap = {};
            books.forEach(b => bookMap[b.symbol] = b);

            const newStats = {};
            tickers.forEach(t => {
                if (!t.symbol.endsWith('USDT') || EXCLUDE.includes(t.symbol)) return;

                const price = parseFloat(t.lastPrice);
                const high = parseFloat(t.highPrice);
                const low = parseFloat(t.lowPrice);
                const vAvg = parseFloat(t.weightedAvgPrice); // Áî®ÊñºÊ®°Êì¨ MA Âü∫Á∑ö
                const change = parseFloat(t.priceChangePercent);
                const vol = parseFloat(t.quoteVolume);

                // 1. MA Êì†Â£ìË®àÁÆó (Êú¨Âú∞ÈÅãÁÆóÂõûÊ≠∏)
                const maSqz = (high - low) / vAvg;
                const isSqz = maSqz < FILTER.SQZ;

                // 2. POC Á™ÅÁ†¥Ë®àÁÆó (Êú¨Âú∞ÈÅãÁÆóÂõûÊ≠∏)
                // Ê®°Êì¨ POCÔºöÂà©Áî®Âä†Ê¨äÂπ≥ÂùáÂÉπËàáÁï∂ÂâçÂÉπÊ†ºÁöÑÂÅèÈõ¢
                const mockPoc = vAvg;
                const isPocBrk = price > mockPoc * (1 + FILTER.POC);

                // 3. ÁúüÁ©∫ÂçÄ DRV Ë©ïÂàÜ (Êú¨Âú∞ÈÅãÁÆóÂõûÊ≠∏)
                const drvScore = Math.min(100, (Math.abs(change) / (vol / 1e8)) * 15);

                // 4. Ë®ÇÂñÆÁ∞øÂÆâÂÖ®
                const b = bookMap[t.symbol];
                const spread = b ? (parseFloat(b.askPrice) - parseFloat(b.bidPrice)) / price : 0.01;

                newStats[t.symbol] = {
                    s: t.symbol, price, change, maSqz, poc: mockPoc, drvScore, spread,
                    isSqz, isPocBrk,
                    tsl: price * 0.98, ttp: price * 1.05,
                    totalScore: (isSqz ? 30 : 0) + (isPocBrk ? 40 : 0) + drvScore
                };
            });

            stats = newStats;
            render();
        } catch (e) { console.error(e); }

        window.scanTimer = setTimeout(scan, 3000);
    }

    function render() {
        const list = document.getElementById('list');
        const results = Object.values(stats);
        list.innerHTML = results
            .sort((a,b) => (pinned.has(b.s) - pinned.has(a.s)) || (b.totalScore - a.totalScore))
            .slice(0, 24)
            .map(x => `
                <div class="card p-3 rounded-lg ${x.isPocBrk ? 'poc-break' : ''} ${x.isSqz ? 'ma-squeeze' : ''} ${pinned.has(x.s) ? 'pinned' : ''}" onclick="togglePin('${x.s}')">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <div class="text-white font-black text-xs">${x.s.replace('USDT','')} <span class="text-blue-500">#${x.drvScore.toFixed(0)}</span></div>
                            <div class="text-zinc-500 text-[9px] font-bold">$${x.price.toFixed(4)}</div>
                        </div>
                        <div class="text-right">
                            <div class="${x.change >= 0 ? 'text-green-500' : 'text-red-500'} font-black">${x.change.toFixed(2)}%</div>
                            <div class="text-[8px] text-zinc-600">SPR: ${(x.spread*100).toFixed(3)}%</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-1 mb-2 text-[8px] font-bold uppercase">
                        <div class="bg-zinc-900 p-1 rounded text-zinc-400">POC: ${x.poc.toFixed(4)}</div>
                        <div class="bg-zinc-900 p-1 rounded text-zinc-400">SQZ: ${(x.maSqz*100).toFixed(2)}%</div>
                    </div>
                    <div class="flex gap-1">
                        ${x.isPocBrk ? '<span class="tag bg-green-600 text-black">POC_BRK</span>' : ''}
                        ${x.isSqz ? '<span class="tag bg-orange-500 text-black">MA_SQZ</span>' : ''}
                        ${x.drvScore > FILTER.DRV ? '<span class="tag bg-yellow-500 text-black">Vacuum</span>' : ''}
                    </div>
                    <div class="mt-2 pt-2 border-t border-zinc-900 flex justify-between text-[8px] text-zinc-500">
                        <span>L: ${x.tsl.toFixed(3)}</span>
                        <span>W: ${x.ttp.toFixed(3)}</span>
                    </div>
                </div>
            `).join('');
    }

    function toggleSystem() {
        isRunning = !isRunning;
        document.getElementById('sysBtn').innerText = isRunning ? "Stop Radar" : "Start Radar";
        if(isRunning) scan(); else clearTimeout(window.scanTimer);
    }
    function togglePin(s) { pinned.has(s) ? pinned.delete(s) : pinned.add(s); render(); }

    const bind = (id, vid, key, div) => {
        document.getElementById(id).oninput = (e) => {
            const v = parseFloat(e.target.value);
            FILTER[key] = v / div;
            document.getElementById(vid).innerText = (key==='DRV'?v:(v/10).toFixed(1)+'%');
        }
    };
    bind('i_sqz', 'v_sqz', 'SQZ', 1000);
    bind('i_poc', 'v_poc', 'POC', 1000);
    bind('i_drv', 'v_drv', 'DRV', 1);
</script>
</body>
</html>
