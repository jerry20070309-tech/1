<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>âš¡ HELPER X-TREME V12.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #121212; color: #e0e0e0; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        
        /* ç¶²æ ¼èƒŒæ™¯åœ– */
        .bg-grid {
            background-image: linear-gradient(to right, #1a1a1a 1px, transparent 1px), linear-gradient(to bottom, #1a1a1a 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* å¡ç‰‡åŸºç¤æ¨£å¼ */
        .card { background: rgba(20, 20, 20, 0.9); border: 1px solid #333; transition: 0.3s; position: relative; backdrop-filter: blur(5px); }
        .hunt-card { border: 2px solid #ff4444; box-shadow: 0 0 15px rgba(255, 68, 68, 0.3); animation: pulse-red 2s infinite; }
        .decouple-card { border: 2px solid #a855f7; box-shadow: 0 0 15px rgba(168, 85, 247, 0.4); }
        
        @keyframes pulse-red { 0% { border-color: #ff4444; } 50% { border-color: #880000; } 100% { border-color: #ff4444; } }

        /* ATR è­·ç›¾æ¢ */
        .shield-bg { height: 6px; background: #222; border-radius: 3px; position: relative; overflow: hidden; }
        .shield-fill { height: 100%; background: linear-gradient(90deg, #ff4444 0%, #ffeb3b 50%, #4caf50 100%); }
        .shield-pointer { position: absolute; top: -2px; width: 2px; height: 10px; background: white; box-shadow: 0 0 5px white; }

        /* LV èƒ½é‡æ¢ */
        .lv-bar { height: 4px; background: #111; border-radius: 2px; }
        .lv-fill { height: 100%; background: #00ffcc; box-shadow: 0 0 10px #00ffcc; transition: width 0.5s; }

        /* é ‚éƒ¨è£é£¾æ¢ */
        .header-bar { background: linear-gradient(90deg, #3a1c5e 0%, #121212 50%, #3a1c5e 100%); border-bottom: 2px solid #a855f7; }
    </style>
</head>
<body class="h-screen flex flex-col text-[10px] bg-grid">

    <header class="header-bar p-3 flex justify-between items-center shrink-0 shadow-2xl">
        <div class="flex items-center gap-6">
            <h1 class="text-3xl font-black text-white italic tracking-tighter">HELPER</h1>
            <div id="satStatus" class="px-4 py-1 rounded-full border border-zinc-700 bg-black text-zinc-400 text-[10px]">
                SYSTEM IDLE
            </div>
        </div>
        <div class="flex gap-4">
            <button id="sysBtn" onclick="toggleSystem()" class="bg-white text-black px-10 py-1.5 rounded-sm font-black hover:bg-purple-500 hover:text-white transition-all uppercase italic">
                Start Radar
            </button>
        </div>
    </header>

    <div class="bg-black/60 p-3 border-b border-zinc-800 grid grid-cols-5 gap-6 items-center uppercase text-zinc-500 font-bold">
        <div class="flex flex-col gap-1"><span>ğŸŒ€ SQZ (è“„å‹¢)</span><input type="range" id="i_sqz" min="5" max="50" value="12" class="accent-purple-500"></div>
        <div class="flex flex-col gap-1"><span>ğŸ¯ POC (çªç ´)</span><input type="range" id="i_poc" min="1" max="100" value="11" class="accent-purple-500"></div>
        <div class="flex flex-col gap-1"><span>ğŸš€ DRV (çœŸç©º)</span><input type="range" id="i_drv" min="10" max="150" value="90" class="accent-purple-500"></div>
        <div class="flex flex-col text-center"><span class="text-[8px]">ğŸ’ DEC (è„«é‰¤æ¬Šé‡)</span><div class="text-purple-400 text-xs">DYNAMIC</div></div>
        <div class="flex flex-col text-center"><span class="text-[8px]">ğŸ›¡ï¸ ATR (é˜²ç¦¦å¼•æ“)</span><div class="text-green-400 text-xs">ACTIVE</div></div>
    </div>

    <main class="flex-1 p-4 overflow-y-auto">
        <div id="dashboard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
    </main>

<script>
    // ç­–ç•¥é‚è¼¯å®Œå…¨ä¿ç•™ (å¦‚æ‚¨è¦æ±‚ï¼šå…¶é¤˜ç­–ç•¥éƒ½ä¸å‹•)
    const CONFIG = {
        EXCLUDE: ['BTCUSDT','ETHUSDT','SOLUSDT','XRPUSDT','BNBUSDT'],
        SATURDAY_MODE: new Date().getDay() === 6
    };

    let stats = {}, isRunning = false;
    let btcSnapshot = { price: 0, chg: 0 };

    function initSystem() {
        const status = document.getElementById('satStatus');
        if (CONFIG.SATURDAY_MODE) {
            status.innerHTML = `<span class="text-green-500">â—</span> SATURDAY AMBUSH MODE`;
            status.style.borderColor = "#052e16";
        } else {
            status.innerHTML = `<span class="text-zinc-600">â—</span> STANDBY MODE`;
        }
    }

    async function updateBTC() {
        const r = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=BTCUSDT').then(res => res.json());
        btcSnapshot.price = parseFloat(r.lastPrice);
        btcSnapshot.chg = parseFloat(r.priceChangePercent);
    }

    async function scan() {
        if(!isRunning) return;
        try {
            await updateBTC();
            const tRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r => r.json());
            
            tRes.forEach(t => {
                if (!t.symbol.endsWith('USDT') || CONFIG.EXCLUDE.includes(t.symbol)) return;

                const price = parseFloat(t.lastPrice);
                const altChg = parseFloat(t.priceChangePercent);
                const vol = parseFloat(t.quoteVolume);
                if (vol < 5000000) return;

                let decouplingWeight = 0;
                if (altChg > 1.0 && btcSnapshot.chg <= -0.5) decouplingWeight = 30;
                else if (altChg > btcSnapshot.chg + 2.5) decouplingWeight = 15;

                const range24h = parseFloat(t.highPrice) - parseFloat(t.lowPrice);
                const atrTP = price + (range24h * 1.2); 
                const atrSL = price - (range24h * 0.6);

                // è¨ˆç®—ç•¶å‰åƒ¹åœ¨ ATR å€é–“çš„ä½ç½® (0=SL, 100=TP)
                const shieldPos = Math.min(100, Math.max(0, ((price - atrSL) / (atrTP - atrSL)) * 100));

                const drv = Math.min(100, (Math.abs(altChg) / (vol / 1e8)) * 15);
                const lv = Math.min(10, Math.round((drv / 10) + (Math.abs(altChg) / 2)));

                const sqz = range24h / price;
                let score = (sqz < 0.012 ? 40 : 10) + (drv > 80 ? 30 : 0) + decouplingWeight;
                if (CONFIG.SATURDAY_MODE && sqz < 0.008) score += 20;

                stats[t.symbol] = {
                    s: t.symbol, price, chg: altChg, score, lv, drv,
                    atrTP, atrSL, shieldPos,
                    isDecoupled: decouplingWeight >= 30,
                    sqz: (sqz * 100).toFixed(2)
                };
            });
            render();
        } catch (e) { console.error(e); }
        setTimeout(scan, 3000);
    }

    function render() {
        const dashboard = document.getElementById('dashboard');
        const list = Object.values(stats).sort((a,b) => b.score - a.score).slice(0, 16);

        dashboard.innerHTML = list.map(x => `
            <div class="card p-4 rounded-sm ${x.isDecoupled ? 'decouple-card' : (x.score > 70 ? 'hunt-card' : '')}">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xl font-black text-white italic tracking-tighter">${x.s.replace('USDT','')}</h2>
                    <div class="text-right">
                        <div class="text-[10px] font-bold text-purple-400">SCORE</div>
                        <div class="text-lg font-black leading-none">${x.score.toFixed(0)}</div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between text-[7px] text-zinc-500 mb-1 font-bold">
                        <span>ğŸ›¡ï¸ SL: ${x.atrSL.toFixed(4)}</span>
                        <span>TP: ${x.atrTP.toFixed(4)} ğŸ›¡ï¸</span>
                    </div>
                    <div class="shield-bg">
                        <div class="shield-fill" style="width: 100%"></div>
                        <div class="shield-pointer" style="left: ${x.shieldPos}%"></div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 items-center">
                    <div>
                        <div class="text-[8px] text-zinc-500 mb-1">THRUST LEVEL (LV ${x.lv})</div>
                        <div class="lv-bar"><div class="lv-fill" style="width: ${x.lv * 10}%"></div></div>
                    </div>
                    <div class="text-right">
                        <div class="${x.chg >= 0 ? 'text-green-400' : 'text-red-400'} text-lg font-black">${x.chg > 0 ? '+' : ''}${x.chg}%</div>
                    </div>
                </div>

                <div class="mt-4 pt-2 border-t border-zinc-800 flex justify-between text-[8px] font-bold text-zinc-500">
                    <span>SQZ: ${x.sqz}%</span>
                    <span>DRV: ${x.drv.toFixed(0)}</span>
                </div>

                ${x.isDecoupled ? '<div class="mt-2 text-center bg-purple-600 text-white text-[7px] py-0.5 font-black">DECOUPLING DETECTED</div>' : ''}
            </div>
        `).join('');
    }

    function toggleSystem() { 
        isRunning = !isRunning; 
        document.getElementById('sysBtn').innerText = isRunning ? "Stop Radar" : "Start Radar"; 
        if(isRunning) scan(); 
    }

    initSystem();
</script>
</body>
</html>
