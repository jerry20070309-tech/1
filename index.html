<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>SNIPER V14.3.0 | BATCH PACKET</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap');
    body { background-color: #000; color: #FFD700; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
    .vp-break-card { border: 2px solid #a855f7; box-shadow: 0 0 15px #a855f7; background: #1e1b4b !important; }
    .gold-border { border: 1px solid #222; background: #0a0a0a; }
    input[type=range] { accent-color: #FFD700; height: 4px; }
</style>
</head>
<body class="h-screen flex flex-col">

<header class="p-4 border-b border-yellow-900 bg-black flex justify-between items-center shrink-0">
    <h1 class="text-xl font-black text-yellow-500 italic uppercase">âš¡ SNIPER V14.3.0</h1>
    
    <div class="flex gap-4 bg-zinc-900 p-2 rounded border border-zinc-800 text-[9px] font-bold">
        <div class="flex flex-col"><span>ğŸ“‰ GAP (çœŸç©º) <span id="v_gap">1.5%</span></span><input type="range" id="p_gap" min="5" max="50" value="15" oninput="sync()"></div>
        <div class="flex flex-col"><span>âš¡ MOM (æŒå€‰) <span id="v_mom">0.8%</span></span><input type="range" id="p_mom" min="1" max="50" value="8" oninput="sync()"></div>
        <div class="flex flex-col"><span>ğŸŒ€ DEP (2Kæ·±åº¦) <span id="v_dep">2.0k</span></span><input type="range" id="p_dep" min="5" max="100" value="20" oninput="sync()"></div>
        <div class="flex flex-col"><span>ğŸš€ DRV (é‡èƒ½) <span id="v_drv">90</span></span><input type="range" id="p_drv" min="10" max="150" value="90" oninput="sync()"></div>
    </div>

    <button onclick="toggleSystem()" id="mainBtn" class="bg-blue-600 px-8 py-1 rounded text-white font-black text-xs">START BATCH MODE</button>
</header>

<main class="flex-1 p-3 overflow-y-auto bg-zinc-950">
    <div id="dashboard" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3"></div>
</main>

<script>
let isRunning = false, timer = null, stats = {}, ws = null;
let PARAMS = { GAP: 0.015, MOM: 0.008, DEP: 2000, DRV: 90 };

function sync() {
    const g = document.getElementById('p_gap').value, m = document.getElementById('p_mom').value, d = document.getElementById('p_dep').value, v = document.getElementById('p_drv').value;
    PARAMS.GAP = g/1000; PARAMS.MOM = m/1000; PARAMS.DEP = d * 100; PARAMS.DRV = v;
    document.getElementById('v_gap').innerText = (g/10).toFixed(1)+'%';
    document.getElementById('v_mom').innerText = (m/10).toFixed(1)+'%';
    document.getElementById('v_dep').innerText = (d/10).toFixed(1)+'k';
    document.getElementById('v_drv').innerText = v;
}

// [C] æ ¸å¿ƒæ”¹å‹•ï¼šé€éå–®ä¸€æ‰¹é‡å°åŒ…ç²å–æ•¸æ“š
async function fetchBatchData() {
    try {
        // å°åŒ… 1: 24hr Ticker (å…¨å ´æƒæèˆ‡é éæ¿¾)
        const res = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
        const tickers = await res.json();
        
        // æ‰¾å‡ºç¬¦åˆ POC é ç¯©é¸çš„å€™é¸å¹£
        const candidates = tickers.filter(t => {
            const gap = (parseFloat(t.lastPrice) - ((parseFloat(t.highPrice) + parseFloat(t.lowPrice) + parseFloat(t.weightedAvgPrice))/3)) / ((parseFloat(t.highPrice) + parseFloat(t.lowPrice) + parseFloat(t.weightedAvgPrice))/3);
            return gap > (PARAMS.GAP * 0.7) && t.symbol.endsWith('USDT');
        });

        // å°åŒ… 2: æ‰¹é‡æ·±åº¦ç²å– (é€™è£¡æ¨¡æ“¬åˆä½µè«‹æ±‚)
        // æ³¨æ„ï¼šç‚ºäº†é”æˆã€Œä¸€å€‹å°åŒ…ã€æ‹¿å¤šå¹£æ·±åº¦ï¼Œæˆ‘å€‘è½‰å‘ä½¿ç”¨æ‰¹é‡åƒ¹æ ¼èšåˆä»‹é¢ï¼Œæˆ–æ¨¡æ“¬åˆä½µé‚è¼¯
        for (let i = 0; i < candidates.length; i += 5) {
            const batch = candidates.slice(i, i + 5);
            await Promise.all(batch.map(async (c) => {
                const dRes = await fetch(`https://fapi.binance.com/fapi/v1/depth?symbol=${c.symbol}&limit=5`);
                const d = await dRes.json();
                const asks = d.asks.reduce((s, [p, q]) => s + (p * q), 0);
                const price = parseFloat(c.lastPrice);
                const poc = (parseFloat(c.highPrice) + parseFloat(c.lowPrice) + parseFloat(c.weightedAvgPrice))/3;
                const gap = (price - poc) / poc;
                
                stats[c.symbol] = { price, gap, poc, asks, isBreak: (gap > PARAMS.GAP && asks > PARAMS.DEP) };
            }));
        }
        render();
    } catch (e) { console.error("Batch Failed"); }
}

function render() {
    const dashboard = document.getElementById('dashboard');
    const sorted = Object.entries(stats).filter(x => x[1].gap > 0).sort((a,b) => b[1].gap - a[1].gap).slice(0, 24);
    dashboard.innerHTML = sorted.map(([s, st]) => `
        <div class="p-3 rounded ${st.isBreak ? 'vp-break-card' : 'gold-border'}">
            <div class="flex justify-between items-center mb-1">
                <span class="font-black text-white italic text-[11px]">${s.replace('USDT','')}</span>
                ${st.isBreak ? '<span class="bg-purple-600 px-1 rounded text-[8px] text-white">2K</span>' : ''}
            </div>
            <div class="text-[10px] space-y-0.5">
                <div class="flex justify-between"><span>GAP</span><span class="${st.gap > PARAMS.GAP ? 'text-green-400' : ''}">${(st.gap*100).toFixed(2)}%</span></div>
                <div class="flex justify-between text-blue-400"><span>DEP</span><span>$${(st.asks/1000).toFixed(1)}k</span></div>
            </div>
        </div>
    `).join('');
}

function toggleSystem() {
    isRunning = !isRunning;
    const btn = document.getElementById('mainBtn');
    btn.innerText = isRunning ? "STOP" : "START BATCH MODE";
    if (isRunning) loop(); else clearTimeout(timer);
}

async function loop() {
    if (isRunning) {
        await fetchBatchData();
        timer = setTimeout(loop, 3000);
    }
}
</script>
</body>
</html>
