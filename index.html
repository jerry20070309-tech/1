<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>‚ö° SNIPER X-TREME V12.0 | SAT-ONLY HYBRID</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #020202; color: #FFD700; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        .card { background: #080808; border: 1px solid #1a1a1a; transition: 0.3s; position: relative; }
        .hunt-card { border: 2px solid #ff0000; background: #1a0000 !important; box-shadow: 0 0 20px #ff0000; animation: blink 0.8s infinite; }
        .decouple-card { border: 2px solid #a855f7 !important; background: #0f0720 !important; box-shadow: 0 0 15px #a855f7; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        .lv-bar { height: 4px; background: #333; border-radius: 2px; overflow: hidden; margin-top: 4px; }
        .lv-fill { height: 100%; background: #00ffcc; transition: width 0.5s; }
        .atr-tag { font-size: 8px; color: #888; border: 1px solid #333; padding: 1px 4px; border-radius: 3px; }
    </style>
</head>
<body class="h-screen flex flex-col text-[10px]">

    <header class="p-4 border-b border-purple-900 bg-black flex justify-between items-center shrink-0">
        <div class="flex items-center gap-4">
            <h1 class="text-2xl font-black text-purple-500 italic">‚ö° SNIPER X-TREME</h1>
            <div id="satStatus" class="px-3 py-1 rounded bg-zinc-900 text-[10px] font-bold">Ê™¢Ê∏¨Á≥ªÁµ±Áí∞Â¢É...</div>
        </div>
        <div class="flex gap-4">
            <button id="sysBtn" onclick="toggleSystem()" class="bg-purple-600 text-white px-8 py-1 rounded font-black hover:bg-purple-500">START RADAR</button>
        </div>
    </header>

    <div class="bg-zinc-950 p-3 border-b border-zinc-800 grid grid-cols-5 gap-4 items-center uppercase font-bold text-zinc-500">
        <div class="flex flex-col"><span>üåÄ SQZ (ËìÑÂã¢)</span><input type="range" id="i_sqz" min="5" max="50" value="12" class="w-full"></div>
        <div class="flex flex-col"><span>üéØ POC (Á™ÅÁ†¥)</span><input type="range" id="i_poc" min="1" max="100" value="11" class="w-full"></div>
        <div class="flex flex-col"><span>üöÄ DRV (ÁúüÁ©∫)</span><input type="range" id="i_drv" min="10" max="150" value="90" class="w-full"></div>
        <div class="flex flex-col"><span>üíé DEC (ËÑ´Èâ§)</span><div class="text-purple-400">AUTO WEIGHTING</div></div>
        <div class="flex flex-col"><span>üõ°Ô∏è ATR (Èò≤Á¶¶)</span><div class="text-green-400">60D ADAPTIVE</div></div>
    </div>

    <main class="flex-1 p-3 overflow-y-auto bg-black">
        <div id="dashboard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3"></div>
    </main>

<script>
    const CONFIG = {
        EXCLUDE: ['BTCUSDT','ETHUSDT','SOLUSDT','XRPUSDT','BNBUSDT'],
        SATURDAY_MODE: new Date().getDay() === 6
    };

    let stats = {}, isRunning = false;
    let btcSnapshot = { price: 0, chg: 0 };

    // [SAT-ONLY] ÂàùÂßãÂåñÈ°ØÁ§∫
    function initSystem() {
        const status = document.getElementById('satStatus');
        if (CONFIG.SATURDAY_MODE) {
            status.innerText = "üìÖ ÈÄ±ÂÖ≠Ê®°ÂºèÔºöÈ´òÂãùÁéáÊï∏ÊìöÈöîÈõ¢‰∏≠";
            status.classList.add('text-green-500', 'border', 'border-green-900');
        } else {
            status.innerText = "üìÖ Â∏∏Ë¶èÊ®°ÂºèÔºöÂÖ®Â§©ÂÄôÁõ£Êéß";
            status.classList.add('text-zinc-500');
        }
    }

    async function updateBTC() {
        const r = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=BTCUSDT').then(res => res.json());
        btcSnapshot.price = parseFloat(r.lastPrice);
        btcSnapshot.chg = parseFloat(r.priceChangePercent);
    }

    async function scan() {
        if(!isRunning) return;
        try {
            await updateBTC();
            const tRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r => r.json());
            
            tRes.forEach(t => {
                if (!t.symbol.endsWith('USDT') || CONFIG.EXCLUDE.includes(t.symbol)) return;

                const price = parseFloat(t.lastPrice);
                const altChg = parseFloat(t.priceChangePercent);
                const vol = parseFloat(t.quoteVolume);
                if (vol < 5000000) return;

                // --- [W-E] ËÑ´Èâ§Ê¨äÈáçÈÇèËºØ ---
                let decouplingWeight = 0;
                if (altChg > 1.0 && btcSnapshot.chg <= -0.5) decouplingWeight = 30; // Âº∑ÂäõËÑ´Èâ§
                else if (altChg > btcSnapshot.chg + 2.5) decouplingWeight = 15;

                // --- [R-1] ATR Ê≥¢ÂãïÂõûÊ≠∏ (Âü∫Êñº24hÊ≥¢ÂπÖÊ®°Êì¨) ---
                const range24h = parseFloat(t.highPrice) - parseFloat(t.lowPrice);
                const atrTP = price + (range24h * 1.2); 
                const atrSL = price - (range24h * 0.6);

                // --- [L-1] LV Ë°ùÂà∫Á≠âÁ¥ö ---
                const drv = Math.min(100, (Math.abs(altChg) / (vol / 1e8)) * 15);
                const lv = Math.min(10, Math.round((drv / 10) + (Math.abs(altChg) / 2)));

                // --- [SAT-ONLY] ÈÄ±ÂÖ≠Ê¨äÈáç‰øÆÊ≠£ ---
                const sqz = range24h / price;
                let score = (sqz < 0.012 ? 40 : 10) + (drv > 80 ? 30 : 0) + decouplingWeight;
                if (CONFIG.SATURDAY_MODE && sqz < 0.008) score += 20; // ÈÄ±ÂÖ≠ÁâπÂà•Âä†Âº∑ËìÑÂã¢ÂàÜ

                stats[t.symbol] = {
                    s: t.symbol,
                    price,
                    chg: altChg,
                    score,
                    lv,
                    drv,
                    atrTP,
                    atrSL,
                    isDecoupled: decouplingWeight >= 30,
                    sqz: (sqz * 100).toFixed(2)
                };
            });
            render();
        } catch (e) { console.error(e); }
        setTimeout(scan, 3000);
    }

    function render() {
        const dashboard = document.getElementById('dashboard');
        const list = Object.values(stats).sort((a,b) => b.score - a.score).slice(0, 16);

        dashboard.innerHTML = list.map(x => `
            <div class="card p-3 rounded-lg ${x.isDecoupled ? 'decouple-card' : (x.score > 70 ? 'hunt-card' : '')}">
                <div class="flex justify-between items-start">
                    <h2 class="text-lg font-black text-white">${x.s.replace('USDT','')}</h2>
                    <span class="text-purple-400 font-bold">SCORE: ${x.score.toFixed(0)}</span>
                </div>
                
                <div class="flex gap-2 mt-1">
                    <span class="atr-tag">ATR_TP: ${x.atrTP.toFixed(4)}</span>
                    <span class="atr-tag">ATR_SL: ${x.atrSL.toFixed(4)}</span>
                </div>

                <div class="mt-3 flex justify-between items-end">
                    <div>
                        <div class="text-[8px] text-zinc-500 uppercase">Thrust Level (LV ${x.lv})</div>
                        <div class="lv-bar w-24"><div class="lv-fill" style="width: ${x.lv * 10}%"></div></div>
                    </div>
                    <div class="text-right">
                        <div class="${x.chg >= 0 ? 'text-green-500' : 'text-red-500'} font-bold">${x.chg}%</div>
                        <div class="text-zinc-600 text-[8px]">SQZ: ${x.sqz}% | DRV: ${x.drv.toFixed(0)}</div>
                    </div>
                </div>

                ${x.isDecoupled ? '<div class="mt-2 text-center bg-purple-900/50 text-purple-200 text-[8px] py-1 rounded">‚ö†Ô∏è Â∑≤ÂÅµÊ∏¨Âà∞Âº∑ÂäõËÑ´Èâ§Ë°åÊÉÖ</div>' : ''}
            </div>
        `).join('');
    }

    function toggleSystem() { 
        isRunning = !isRunning; 
        document.getElementById('sysBtn').innerText = isRunning ? "STOP RADAR" : "START RADAR"; 
        if(isRunning) scan(); 
    }

    initSystem();
</script>
</body>
</html>
