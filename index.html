<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>‚ö° SNIPER V12.8.0 | Â∞ÅÂåÖÂ∞çÈΩäÁâà</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #050505; color: #FFD700; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        .card { background: #0a0a0a; border: 1px solid #1a1a1a; transition: 0.3s; }
        .score-90 { border: 2px solid #ff0000; box-shadow: 0 0 20px #ff0000; background: #2a0000 !important; }
        .score-70 { border: 2px solid #a855f7; box-shadow: 0 0 15px #a855f7; background: #1e1b4b !important; }
        .score-40 { border: 2px solid #FFD700; }
        .log-item { border-left: 3px solid #ff0000; padding: 4px; margin-bottom: 4px; background: #1a0000; font-size: 10px; }
    </style>
</head>
<body class="h-screen flex flex-col text-[10px]">

    <header class="p-4 border-b border-yellow-900 bg-black flex justify-between items-center shrink-0">
        <h1 class="text-2xl font-black text-yellow-500 italic uppercase">‚ö° SNIPER V12.8.0</h1>
        <div class="flex gap-2">
            <input id="addS" type="text" placeholder="ÊâãÂãïÊ∑ªÂä† (e.g. BTC)" class="bg-zinc-900 border border-zinc-700 px-3 py-1 text-white text-xs rounded">
            <button onclick="manualAdd()" class="bg-yellow-600 text-black px-4 py-1 font-bold rounded text-xs">ADD</button>
            <button id="sysBtn" onclick="toggleSystem()" class="bg-blue-600 text-white px-8 py-1 rounded font-black text-xs">START</button>
        </div>
    </header>

    <div class="bg-zinc-900/50 p-2 border-b border-yellow-900/30 grid grid-cols-6 gap-4 font-bold text-zinc-400">
        <div class="flex flex-col"><span>üåÄ SQZ</span><input type="range" id="i_sqz" min="5" max="50" value="12"></div>
        <div class="flex flex-col text-green-400"><span>üéØ POC</span><input type="range" id="i_poc" min="5" max="100" value="11"></div>
        <div class="flex flex-col text-blue-400"><span>üöÄ DRV</span><input type="range" id="i_drv" min="10" max="150" value="90"></div>
        <div class="flex flex-col text-orange-500"><span>‚ö° MOM</span><input type="range" id="i_mom" min="1" max="50" value="8"></div>
        <div class="flex flex-col text-pink-500"><span>üìâ REV</span><input type="range" id="i_rev" min="5" max="100" value="20"></div>
        <div class="flex flex-col text-red-500"><span>üö® SLP</span><input type="range" id="i_slp" min="5" max="50" value="15"></div>
    </div>

    <main class="flex-1 flex overflow-hidden">
        <aside class="w-72 border-r border-zinc-800 p-2 overflow-y-auto bg-black shrink-0">
            <div class="text-red-500 font-bold mb-2 uppercase italic text-[11px] tracking-tighter">Elite Log (90+ Score)</div>
            <div id="logs"></div>
        </aside>
        <div id="dashboard" class="flex-1 p-3 overflow-y-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
    </main>

<script>
    let stats = {}, isRunning = false;
    let pinnedCoins = []; // Á¨¶Âêà 70 ÂàÜ‰ª•‰∏äÁöÑÂπ£Á®ÆÊ∏ÖÂñÆ
    let baseOI = {}, oiHistory = {}; 
    let FILTER = { SQZ: 0.012, POC: 0.011, DRV: 90, MOM: 0.008, REV: 0.02, SLP: 1.5 };

    // 1. Â∫ïÂ±§ APIÔºöÂÆåÂÖ®‰æùÁÖß V3.6.7 ÊñπÂºèÊäìÂèñ OI (‰∏ç‰∫ÇÁôºÂ∞ÅÂåÖ)
    async function getOI(symbol) { 
        try { 
            const res = await fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${symbol}`); 
            if (!res.ok) return null;
            const data = await res.json(); 
            return parseFloat(data.openInterest); 
        } catch(e) { return null; } 
    }

    async function scan() {
        if(!isRunning) return;
        try {
            // Ë´ãÊ±ÇÂÖ®Â†¥ 24hr ÂÉπÊ†ºÂ∞ÅÂåÖ (ÈÄôÊòØ‰∏ÄÂÄãÊàêÂäüÁöÑ 200 Ë´ãÊ±Ç)
            const res24 = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
            const data24 = await res24.json();
            
            for (const t of data24) {
                const s = t.symbol;
                if (!s.endsWith('USDT') || ['BTCUSDT','ETHUSDT'].includes(s)) continue;

                const curPrice = parseFloat(t.lastPrice);
                const high = parseFloat(t.highPrice);
                const low = parseFloat(t.lowPrice);
                const avgPrice = parseFloat(t.weightedAvgPrice);
                
                // POC Ë®àÁÆó (Êàê‰∫§ÈáèÈ´òÂ≥∞Âπ≥ÂùáÂÉπ)
                const pocPrice = (high + low + avgPrice) / 3;
                const drv = Math.min(100, (Math.abs(parseFloat(t.priceChangePercent)) / (parseFloat(t.quoteVolume) / 1e8)) * 15);

                // ÊâìÂàÜÁ≥ªÁµ±
                let score = 0;
                if (curPrice > pocPrice) score += 40; 
                if (drv > (parseFloat(document.getElementById('i_drv').value))) score += 30;
                if (parseFloat(t.priceChangePercent) > 0) score += 30;

                // 2. Âª∫Á´ãÂü∫Ê∫ñÈªû (baseOI)ÔºöÂè™ÊúâÁ¨¶Âêà 70 ÂàÜÊâçÂéªÊãøÁ¨¨‰∏ÄÊ¨° OI
                if (score >= 70 && !pinnedCoins.includes(s)) {
                    pinnedCoins.push(s);
                    const initOI = await getOI(s);
                    if (initOI) baseOI[s] = initOI;
                }

                // 3. ÊåÅÁ∫åÁõ£Êéß (oiHistory)ÔºöÂè™Â∞çÊ∏ÖÂñÆÂÖßÁöÑÂπ£Êäì OIÔºå‰∏ç‰∫ÇÁôº
                if (pinnedCoins.includes(s)) {
                    const currentOI = await getOI(s);
                    if (currentOI && baseOI[s]) {
                        oiHistory[s] = currentOI;
                        const growth = (oiHistory[s] - baseOI[s]) / baseOI[s];

                        stats[s] = {
                            s, price: curPrice, score, poc: pocPrice,
                            growth: growth,
                            tsl: pocPrice, // ÁßªÂãïÊ≠¢ÊêçÂ∞çÈΩä POC
                            ttp: curPrice + (curPrice - pocPrice) // Ê≠¢Áõà
                        };

                        // 90ÂàÜÊó•Ë™åË®òÈåÑ (Â§©ÂÉπÁ¥ÄÈåÑ)
                        if (score >= 90) {
                            const log = document.getElementById('logs');
                            const key = `${s}_${Math.floor(curPrice)}`;
                            if (!document.getElementById(key)) {
                                const entry = document.createElement('div');
                                entry.id = key;
                                entry.className = 'log-item';
                                entry.innerHTML = `<b>${new Date().toLocaleTimeString()}</b> | ${s}<br>Price: $${curPrice} | MOM: +${(growth*100).toFixed(2)}%`;
                                log.prepend(entry);
                            }
                        }
                    }
                }
            }
            render();
        } catch (e) { console.error("API Error"); }
        setTimeout(scan, 3000); // 3Áßí‰∏ÄÊéÉ
    }

    function render() {
        const dashboard = document.getElementById('dashboard');
        const list = Object.values(stats).filter(x => pinnedCoins.includes(x.s)).sort((a,b) => b.score - a.score);
        dashboard.innerHTML = list.map(x => `
            <div class="card p-4 rounded-lg ${x.score >= 90 ? 'score-90' : (x.score >= 70 ? 'score-70' : 'score-40')}">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-2xl font-black text-white italic">${x.s.replace('USDT','')}</h2>
                    <span class="text-yellow-500 font-bold text-lg">‚òÖ ${x.score}</span>
                </div>
                <div class="grid grid-cols-2 gap-2 text-[10px] font-bold mb-3 uppercase">
                    <div class="text-zinc-400">Price: <span class="text-white">$${x.price.toFixed(4)}</span></div>
                    <div class="text-zinc-400 text-right text-green-400">OI Œî: +${(x.growth * 100).toFixed(2)}%</div>
                    <div class="text-zinc-400">POC: <span class="text-blue-400">$${x.poc.toFixed(4)}</span></div>
                </div>
                <div class="border-t border-zinc-800 pt-2 flex justify-between font-black">
                    <div class="text-red-500">SL: $${x.tsl.toFixed(4)}</div>
                    <div class="text-green-500 text-right">TP: $${x.ttp.toFixed(4)}</div>
                </div>
            </div>
        `).join('');
    }

    async function manualAdd() {
        let s = document.getElementById('addS').value.toUpperCase().trim();
        if(!s) return;
        if(!s.endsWith('USDT')) s += 'USDT';
        if(!pinnedCoins.includes(s)) {
            pinnedCoins.push(s);
            baseOI[s] = await getOI(s);
            document.getElementById('addS').value = '';
        }
    }

    function toggleSystem() { 
        isRunning = !isRunning; 
        document.getElementById('sysBtn').innerText = isRunning ? "STOP" : "START";
        document.getElementById('sysBtn').className = isRunning ? "bg-red-600 text-white px-8 py-1 rounded font-black" : "bg-blue-600 text-white px-8 py-1 rounded font-black";
        if(isRunning) scan(); 
    }
</script>
</body>
</html>
