<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>SNIPER V3.6.8 | GitHub éƒ¨ç½²ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #000; color: #FFD700; font-family: monospace; }
        .vp-break-card { border: 2px solid #a855f7; box-shadow: 0 0 20px #a855f7; }
        .gold-border { border: 1px solid #FFD700; }
    </style>
</head>
<body class="p-5">
    <div class="mb-5 flex gap-4">
        <input id="symbolInput" type="text" value="BTCUSDT" class="bg-zinc-800 p-2 text-white border border-zinc-600">
        <button onclick="startMonitor()" class="bg-yellow-600 text-black px-6 py-2 font-bold rounded">å•Ÿå‹•ç›£æ§</button>
    </div>
    
    <div id="dashboard" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

<script>
    // --- é€™æ˜¯ä½ åœ–ç‰‡ä¸­çš„æ ¸å¿ƒé‚è¼¯ï¼Œæˆ‘ç²¾ç¢ºåœ°é‚„åŸä¸¦ä¿®æ­£äº†è®Šæ•¸èª¿ç”¨ ---
    function checkVolumeProfileBreakout(klines, currentPrice) {
        let maxHigh = 0; let highIdx = 0; 
        klines.forEach((k, i) => { 
            let h = parseFloat(k[2]); // High price
            if (h > maxHigh) { maxHigh = h; highIdx = i; } 
        }); 
        
        const rangeKlines = klines.slice(highIdx); 
        if (rangeKlines.length < 5) return { isBreakout: false, pocHigh: 0 }; 

        const lows = rangeKlines.map(k => parseFloat(k[3])); 
        const highs = rangeKlines.map(k => parseFloat(k[2])); 
        const minP = Math.min(...lows); 
        const maxP = Math.max(...highs); 
        const binSize = (maxP - minP) / 20; 
        
        const bins = new Array(20).fill(0); 
        rangeKlines.forEach(k => { 
            const vol = parseFloat(k[5]); // Volume
            const avgP = (parseFloat(k[2]) + parseFloat(k[3])) / 2; 
            const binIdx = Math.min(19, Math.floor((avgP - minP) / binSize)); 
            bins[binIdx] += vol; 
        }); 

        const maxVolBinIdx = bins.indexOf(Math.max(...bins)); 
        const pocPrice = minP + (maxVolBinIdx * binSize); 
        const pocHigh = pocPrice + binSize; 
        
        return { isBreakout: currentPrice > pocHigh, pocHigh }; 
    }

    // --- é€™æ˜¯ç¢ºä¿ç¨‹å¼èƒ½ã€Œæ­£å¸¸é‹è¡Œã€çš„æ•¸æ“šä¸²æ¥å¼•æ“ ---
    async function startMonitor() {
        const symbol = document.getElementById('symbolInput').value.toUpperCase();
        const dashboard = document.getElementById('dashboard');
        dashboard.innerHTML = '<p class="text-zinc-500">æ­£åœ¨ç²å–æ•¸æ“š...</p>';

        try {
            // 1. ç²å–ç•¶å‰åƒ¹æ ¼
            const priceRes = await fetch(`https://fapi.binance.com/fapi/v1/ticker/price?symbol=${symbol}`);
            const priceData = await priceRes.json();
            const currentPrice = parseFloat(priceData.price);

            // 2. ç²å– K ç·šè³‡æ–™
            const kRes = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=1h&limit=100`);
            const klines = await kRes.json();

            // 3. åŸ·è¡Œä½ çš„ VP é‚è¼¯
            const result = checkVolumeProfileBreakout(klines, currentPrice);

            // 4. æ¸²æŸ“ UI
            dashboard.innerHTML = `
                <div class="p-6 bg-zinc-900 rounded-lg ${result.isBreakout ? 'vp-break-card' : 'gold-border'}">
                    <h2 class="text-3xl font-black mb-2">${symbol}</h2>
                    <p class="text-xl">ç•¶å‰åƒ¹æ ¼: <span class="text-white">${currentPrice}</span></p>
                    <p class="text-xl">POC é ‚éƒ¨: <span class="text-zinc-400">${result.pocHigh.toFixed(4)}</span></p>
                    <div class="mt-4 p-2 text-center font-bold text-2xl ${result.isBreakout ? 'bg-purple-600 text-white' : 'bg-zinc-800 text-zinc-500'}">
                        ${result.isBreakout ? 'ğŸš€ å·²çªç ´ç±Œç¢¼å¯†é›†å€' : 'â˜ï¸ å°šåœ¨å¯†é›†å€å…§'}
                    </div>
                </div>
            `;
        } catch (e) {
            dashboard.innerHTML = `<p class="text-red-500">é‹è¡Œå‡ºéŒ¯: ${e.message}</p>`;
        }
    }
</script>
</body>
</html>
