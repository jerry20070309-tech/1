<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>âš¡ å°å¹«æ‰‹ X-TREME V13.0 | æˆ°é¬¥æ§åˆ¶å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;900&family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #0a0a0a; color: #e0e0e0; font-family: 'JetBrains Mono', 'Noto Sans TC', sans-serif; overflow: hidden; }
        .bg-grid { background-image: radial-gradient(#222 1px, transparent 1px); background-size: 20px 20px; }

        /* å¡ç‰‡èˆ‡ç™¼å…‰æ•ˆæœ */
        .card { background: rgba(15, 15, 15, 0.95); border: 1px solid #333; position: relative; backdrop-filter: blur(10px); }
        .hunt-card { border: 2px solid #ff4444; box-shadow: inset 0 0 10px rgba(255, 68, 68, 0.2); animation: glow-red 2s infinite; }
        .decouple-card { border: 2px solid #a855f7; box-shadow: inset 0 0 10px rgba(168, 85, 247, 0.3); }
        @keyframes glow-red { 0%, 100% { border-color: #ff4444; } 50% { border-color: #660000; } }

        /* ATR è­·ç›¾æ¢è¦–è¦ºåŒ– */
        .shield-bg { height: 8px; background: #1a1a1a; border-radius: 4px; position: relative; overflow: hidden; border: 1px solid #333; }
        .shield-fill { height: 100%; background: linear-gradient(90deg, #ff4444 0%, #ffeb3b 50%, #4caf50 100%); opacity: 0.6; }
        .shield-pointer { position: absolute; top: 0; width: 4px; height: 100%; background: #fff; box-shadow: 0 0 8px #fff; transition: left 0.3s cubic-bezier(0.17, 0.67, 0.83, 0.67); }

        /* æ—¥èªŒå€åŸŸ */
        #combat-log { font-size: 9px; color: #00ffcc; line-height: 1.4; scrollbar-width: none; }
        .log-entry { border-left: 2px solid #00ffcc; padding-left: 5px; margin-bottom: 4px; background: rgba(0, 255, 204, 0.05); }

        /* ä¸­æ–‡æ¨™ç±¤å¼·åŒ– */
        .label-zh { font-size: 10px; font-weight: 900; color: #888; letter-spacing: 1px; }
    </style>
</head>
<body class="h-screen flex flex-col bg-grid">

    <header class="p-3 border-b-2 border-purple-900 bg-black flex justify-between items-center shadow-2xl">
        <div class="flex items-center gap-6">
            <h1 class="text-3xl font-black text-white italic tracking-tighter">å°å¹«æ‰‹ <span class="text-purple-500">X-TREME</span></h1>
            <div id="satStatus" class="px-3 py-1 rounded bg-zinc-900 border border-zinc-700 text-[10px] font-bold">ç³»çµ±å¾…å‘½</div>
        </div>
        <button id="sysBtn" onclick="toggleSystem()" class="bg-purple-600 text-white px-10 py-2 rounded font-black hover:bg-purple-500 transition-all uppercase italic">å•Ÿå‹•é›·é”æƒæ</button>
    </header>

    <nav class="bg-zinc-950/90 p-3 border-b border-zinc-800 grid grid-cols-5 gap-6 items-center shadow-lg">
        <div class="flex flex-col">
            <span class="label-zh">ğŸŒ€ è“„å‹¢å¼·åº¦ (SQZ)</span>
            <input type="range" id="i_sqz" min="5" max="50" value="12" class="accent-purple-500">
        </div>
        <div class="flex flex-col">
            <span class="label-zh">ğŸ¯ çªç ´è‡¨ç•Œ (POC)</span>
            <input type="range" id="i_poc" min="1" max="100" value="11" class="accent-purple-500">
        </div>
        <div class="flex flex-col">
            <span class="label-zh">ğŸš€ çœŸç©ºé©…å‹• (DRV)</span>
            <input type="range" id="i_drv" min="10" max="150" value="90" class="accent-purple-500">
        </div>
        <div class="text-center">
            <span class="label-zh">ğŸ’ è„«é‰¤åµæ¸¬</span>
            <div class="text-purple-400 font-bold text-xs mt-1">è‡ªå‹•æ¬Šé‡ä¸­</div>
        </div>
        <div class="text-center">
            <span class="label-zh">ğŸ›¡ï¸ ATR é˜²ç¦¦</span>
            <div id="atr-status" class="text-green-400 font-bold text-xs mt-1">å‹•æ…‹ç¸®ç·Š: ON</div>
        </div>
    </nav>

    <div class="flex flex-1 overflow-hidden">
        <main class="flex-1 p-4 overflow-y-auto">
            <div id="dashboard" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        </main>

        <aside class="w-64 border-l border-zinc-800 bg-black/50 p-3 flex flex-col">
            <div class="label-zh mb-4 border-b border-zinc-700 pb-2 flex justify-between">
                <span>âš”ï¸ æˆ°é¬¥æ—¥èªŒ</span>
                <span class="text-zinc-600">LIVE</span>
            </div>
            <div id="combat-log" class="flex-1 overflow-y-auto">
                <div class="log-entry">ç³»çµ±åˆå§‹åŒ–å®Œæˆ...</div>
            </div>
        </aside>
    </div>

<script>
    const CONFIG = {
        EXCLUDE: ['BTCUSDT','ETHUSDT','SOLUSDT','XRPUSDT','BNBUSDT'],
        SATURDAY_MODE: new Date().getDay() === 6
    };

    let stats = {}, isRunning = false;
    let btcSnapshot = { chg: 0 };

    function initSystem() {
        const status = document.getElementById('satStatus');
        if (CONFIG.SATURDAY_MODE) {
            status.innerHTML = `<span class="text-green-500">â—</span> é€±å…­åŸ‹ä¼æ¨¡å¼å•Ÿå‹•`;
            addLog("åµæ¸¬åˆ°ä»Šæ—¥ç‚ºé€±å…­ï¼Œè‡ªå‹•åˆ‡æ›è‡³é«˜å‹ç‡åŸ‹ä¼ç­–ç•¥ã€‚");
        } else {
            status.innerHTML = `<span class="text-blue-500">â—</span> å¸¸è¦æƒææ¨¡å¼`;
        }
    }

    function addLog(msg) {
        const log = document.getElementById('combat-log');
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
        log.prepend(entry);
    }

    async function scan() {
        if(!isRunning) return;
        try {
            const bRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr?symbol=BTCUSDT').then(r => r.json());
            btcSnapshot.chg = parseFloat(bRes.priceChangePercent);

            const tRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr').then(r => r.json());
            
            tRes.forEach(t => {
                if (!t.symbol.endsWith('USDT') || CONFIG.EXCLUDE.includes(t.symbol)) return;

                const price = parseFloat(t.lastPrice);
                const altChg = parseFloat(t.priceChangePercent);
                const vol = parseFloat(t.quoteVolume);
                if (vol < 5000000) return;

                // [POC] çªç ´è¨ˆç®—
                const pocVal = Math.abs(altChg);
                const userPoc = document.getElementById('i_poc').value / 10;

                // [W-E] è„«é‰¤é‚è¼¯
                let decouplingWeight = 0;
                if (altChg > 1.0 && btcSnapshot.chg <= -0.5) {
                    decouplingWeight = 30;
                    if (!stats[t.symbol]?.isDecoupled) addLog(`ğŸ”¥ å¼·åŠ›è„«é‰¤åµæ¸¬: ${t.symbol}`);
                }

                // [R-1] ATR é˜²ç¦¦çµåˆ POC 
                const range24h = parseFloat(t.highPrice) - parseFloat(t.lowPrice);
                // é€™è£¡å¯¦ä½œ R-1 è·Ÿ POC çµåˆï¼šPOC è¶Šé«˜ï¼Œç¸®å¾—è¶Šç·Š
                const pocTighten = Math.max(0.2, 0.6 - (pocVal / 5)); 
                const atrTP = price + (range24h * 1.2); 
                const atrSL = price - (range24h * pocTighten);
                const shieldPos = Math.min(100, Math.max(0, ((price - atrSL) / (atrTP - atrSL)) * 100));

                const drv = Math.min(100, (Math.abs(altChg) / (vol / 1e8)) * 15);
                const lv = Math.min(10, Math.round((drv / 10) + (Math.abs(altChg) / 2)));

                const sqz = range24h / price;
                let score = (sqz < 0.012 ? 40 : 10) + (drv > 80 ? 30 : 0) + decouplingWeight;

                stats[t.symbol] = {
                    s: t.symbol, price, chg: altChg, score, lv, drv,
                    atrTP, atrSL, shieldPos,
                    isDecoupled: decouplingWeight >= 30,
                    sqz: (sqz * 100).toFixed(2),
                    isPocHit: pocVal > userPoc
                };
            });
            render();
        } catch (e) { console.error(e); }
        setTimeout(scan, 3000);
    }

    function render() {
        const dashboard = document.getElementById('dashboard');
        const list = Object.values(stats).sort((a,b) => b.score - a.score).slice(0, 12);

        dashboard.innerHTML = list.map(x => `
            <div class="card p-4 rounded ${x.isDecoupled ? 'decouple-card' : (x.score > 75 ? 'hunt-card' : '')}">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <div class="flex items-center gap-2">
                            <h2 class="text-2xl font-black text-white italic">${x.s.replace('USDT','')}</h2>
                            ${x.isPocHit ? '<span class="animate-ping w-2 h-2 bg-orange-500 rounded-full"></span>' : ''}
                        </div>
                        <div class="label-zh">çªç ´ç‹€æ…‹: ${x.isPocHit ? '<span class="text-orange-500">é»ç«ä¸­</span>' : 'è“„èƒ½ä¸­'}</div>
                    </div>
                    <div class="text-right">
                        <div class="label-zh text-purple-400">ç¶œåˆè©•åˆ†</div>
                        <div class="text-2xl font-black text-white leading-none">${x.score.toFixed(0)}</div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex justify-between text-[8px] font-bold text-zinc-500 mb-1">
                        <span>ğŸ›¡ï¸ æ­¢æé˜²ç·š: ${x.atrSL.toFixed(4)}</span>
                        <span>ç›®æ¨™æ­¢ç›ˆ: ${x.atrTP.toFixed(4)}</span>
                    </div>
                    <div class="shield-bg">
                        <div class="shield-fill" style="width: 100%"></div>
                        <div class="shield-pointer" style="left: ${x.shieldPos}%"></div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <div class="label-zh mb-1">è¡åˆºç­‰ç´š LV ${x.lv}</div>
                        <div class="h-1.5 bg-zinc-800 rounded-full overflow-hidden">
                            <div class="h-full bg-cyan-400 shadow-[0_0_10px_#22d3ee]" style="width: ${x.lv * 10}%"></div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="${x.chg >= 0 ? 'text-green-400' : 'text-red-400'} text-xl font-black">${x.chg > 0 ? '+' : ''}${x.chg}%</div>
                    </div>
                </div>

                <div class="mt-4 pt-2 border-t border-zinc-800 flex justify-between label-zh">
                    <span>SQZ (å£“ç¸®): ${x.sqz}%</span>
                    <span>DRV (çœŸç©º): ${x.drv.toFixed(0)}</span>
                </div>
            </div>
        `).join('');
    }

    function toggleSystem() { 
        isRunning = !isRunning; 
        document.getElementById('sysBtn').innerText = isRunning ? "åœæ­¢é›·é”" : "å•Ÿå‹•é›·é”æƒæ"; 
        if(isRunning) scan(); 
    }

    initSystem();
</script>
</body>
</html>
