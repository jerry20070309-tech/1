<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>‚ö° SNIPER V12.7.0 | PURE OI LOGIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #050505; color: #FFD700; font-family: 'JetBrains Mono', monospace; overflow: hidden; }
        .card { background: #0a0a0a; border: 1px solid #1a1a1a; transition: 0.3s; }
        .score-90 { border: 2px solid #ff0000; box-shadow: 0 0 20px #ff0000; background: #2a0000 !important; }
        .score-70 { border: 2px solid #a855f7; box-shadow: 0 0 15px #a855f7; background: #1e1b4b !important; }
        .log-item { border-left: 3px solid #ff0000; padding: 4px; margin-bottom: 4px; background: #1a0000; font-size: 9px; }
    </style>
</head>
<body class="h-screen flex flex-col text-[10px]">

    <header class="p-4 border-b border-yellow-900 bg-black flex justify-between items-center">
        <h1 class="text-2xl font-black text-yellow-500 italic">‚ö° SNIPER V12.7.0</h1>
        <div class="flex gap-4">
            <input id="manualCoin" type="text" placeholder="ÊâãÂãïÊ∑ªÂä† (e.g. BTC)" class="bg-zinc-900 border border-zinc-700 px-2 py-1 text-white">
            <button onclick="manualAdd()" class="bg-yellow-600 text-black px-4 py-1 font-bold rounded">ADD</button>
            <button id="sysBtn" onclick="toggleSystem()" class="bg-blue-600 text-white px-8 py-1 rounded font-black">START</button>
        </div>
    </header>

    <div class="bg-zinc-900/50 p-2 border-b border-yellow-900/30 flex justify-around text-zinc-400 font-bold">
        <span>üåÄ SQZ <input type="range" id="i_sqz" class="w-16"></span>
        <span>üéØ POC <input type="range" id="i_poc" class="w-16"></span>
        <span>üöÄ DRV <input type="range" id="i_drv" class="w-16"></span>
        <span>‚ö° MOM <input type="range" id="i_mom" class="w-16"></span>
        <span>üìâ REV <input type="range" id="i_rev" class="w-16"></span>
        <span>üö® SLP <input type="range" id="i_slp" class="w-16"></span>
    </div>

    <main class="flex-1 flex overflow-hidden">
        <aside class="w-64 border-r border-zinc-800 p-2 overflow-y-auto bg-black text-red-500">
            <div class="font-bold mb-2 uppercase italic">Elite Log (Score 90+)</div>
            <div id="logs"></div>
        </aside>
        <div id="dashboard" class="flex-1 p-3 overflow-y-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
    </main>

<script>
    let stats = {}, isRunning = false;
    let pinnedCoins = []; // Â≠òÊîæÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑÂπ£Á®Æ
    let baseOI = {}, oiHistory = {}; 
    let FILTER = { SQZ: 0.012, POC: 0.011, DRV: 90, MOM: 0.008, REV: 0.02, SLP: 1.5 };

    // 1. Â∫ïÂ±§ API Ë´ãÊ±ÇÂáΩÂºèÔºöÂö¥Ê†ºÈÅµÂÆà getOI(symbol)
    async function getOI(symbol) { 
        try { 
            const res = await fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${symbol}`); 
            const data = await res.json(); 
            return parseFloat(data.openInterest); 
        } catch(e) { return null; } 
    }

    async function scan() {
        if(!isRunning) return;
        try {
            // Â∞ÅÂåÖ A: Âè™ÊãøÂÖ®Â†¥ÂÉπÊ†ºË°®
            const res24 = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
            const data24 = await res24.json();
            
            for (const t of data24) {
                const s = t.symbol;
                if (!s.endsWith('USDT') || ['BTCUSDT','ETHUSDT'].includes(s)) continue;

                const curPrice = parseFloat(t.lastPrice);
                const high = parseFloat(t.highPrice);
                const low = parseFloat(t.lowPrice);
                const avg = parseFloat(t.weightedAvgPrice);
                const drv = Math.min(100, (Math.abs(parseFloat(t.priceChangePercent)) / (parseFloat(t.quoteVolume) / 1e8)) * 15);

                // Ë®àÁÆó POC (ÈáèÂÉπÈ´òÂ≥∞Âπ≥ÂùáÂÉπ)
                const pocPrice = (high + avg) / 2;
                
                // ÊâìÂàÜÈÇèËºØ
                let score = 0;
                if (curPrice > pocPrice) score += 40;
                if (drv > FILTER.DRV) score += 30;
                if (parseFloat(t.priceChangePercent) > 0) score += 30;

                // 2. Âª∫Á´ãÂü∫Ê∫ñÈªûÔºöÁï∂ÂàÜÊï∏ÈÅîÂà∞ÈñÄÊ™ª‰∏î‰∏çÂú®Ê∏ÖÂñÆ‰∏≠ÔºåÊâçÊäì‰∏ÄÊ¨° baseOI
                if (score >= 70 && !pinnedCoins.includes(s)) {
                    pinnedCoins.push(s);
                    baseOI[s] = await getOI(s);
                }

                // 3. ÊåÅÁ∫åÁõ£ÊéßËàáËøΩËπ§ÔºöÈáùÂ∞çÂú®Ê∏ÖÂñÆ‰∏≠ÁöÑÂπ£Á®ÆÊõ¥Êñ∞ oiHistory
                if (pinnedCoins.includes(s)) {
                    const currentOI = await getOI(s);
                    if (currentOI && baseOI[s]) {
                        oiHistory[s] = currentOI;
                        
                        // 4. Ë®àÁÆó Growth (MOM)
                        const growth = (oiHistory[s] - baseOI[s]) / baseOI[s];
                        
                        // Êõ¥Êñ∞Áµ±Ë®àÊï∏Êìö
                        stats[s] = {
                            s, price: curPrice, score, poc: pocPrice,
                            growth: growth,
                            tsl: pocPrice,
                            ttp: curPrice + (curPrice - pocPrice)
                        };

                        // 90ÂàÜÂ§©ÂÉπÁ¥ÄÈåÑ
                        if (score >= 90) {
                            const log = document.getElementById('logs');
                            log.innerHTML = `<div class="log-item"><b>${new Date().toLocaleTimeString()}</b> ${s}<br>$${curPrice} | MOM: +${(growth*100).toFixed(2)}%</div>` + log.innerHTML;
                        }
                    }
                }
            }
            render();
        } catch (e) { console.error("Scan Error"); }
        setTimeout(scan, 3000);
    }

    async function manualAdd() {
        let s = document.getElementById('manualCoin').value.toUpperCase();
        if(!s.endsWith('USDT')) s += 'USDT';
        if(!pinnedCoins.includes(s)) {
            pinnedCoins.push(s);
            baseOI[s] = await getOI(s);
            alert(`${s} Âü∫ÂÆöÂü∫Ê∫ñÈªûÊàêÂäü`);
        }
    }

    function render() {
        const dashboard = document.getElementById('dashboard');
        const list = Object.values(stats).sort((a,b) => b.score - a.score).slice(0, 15);
        dashboard.innerHTML = list.map(x => `
            <div class="card p-4 rounded-lg ${x.score >= 90 ? 'score-90' : (x.score >= 70 ? 'score-70' : '')}">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xl font-black text-white">${x.s.replace('USDT','')}</h2>
                    <span class="text-yellow-500 font-black">SCORE: ${x.score}</span>
                </div>
                <div class="flex justify-between text-[11px] mb-2 font-bold">
                    <span>ÁèæÂÉπ: $${x.price.toFixed(4)}</span>
                    <span class="text-green-400">OIÂ¢ûÂπÖ: +${(x.growth * 100).toFixed(2)}%</span>
                </div>
                <div class="border-t border-zinc-800 pt-2 flex justify-between text-red-500 font-bold">
                    <span>TSL: $${x.tsl.toFixed(4)}</span>
                    <span class="text-green-500">TTP: $${x.ttp.toFixed(4)}</span>
                </div>
            </div>
        `).join('');
    }

    function toggleSystem() { 
        isRunning = !isRunning; 
        document.getElementById('sysBtn').innerText = isRunning ? "STOP" : "START"; 
        if(isRunning) scan(); 
    }
</script>
</body>
</html>
